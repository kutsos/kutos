# KutOS Shell Process Module
# Post-installation customization scripts
---
dontChroot: false

script:
    # Enable essential services
    - command: "systemctl enable NetworkManager"
    - command: "systemctl enable lightdm"

    # Set default locale
    - command: "sed -i 's/#en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen"
    - command: "locale-gen"

    # Ensure KutOS Settings is available
    - command: "chmod +x /usr/local/bin/kutos-settings"
      timeout: 10

    # Copy desktop shortcuts to user home
    - command: >-
        bash -c 'for user_home in /home/*/; do
            user=$(basename "$user_home");
            if [ "$user" != "lost+found" ]; then
                mkdir -p "${user_home}Desktop";
                cp /etc/skel/Desktop/*.desktop "${user_home}Desktop/" 2>/dev/null || true;
                chown -R "$user:$user" "${user_home}Desktop";
            fi;
        done'
      timeout: 30

    # Update mkinitcpio
    - command: "mkinitcpio -P"
      timeout: 120
